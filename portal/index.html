<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="description" content="Global peace-focused translation portal with RSS feeds, gamification, and encrypted notes. Built for sovereignty, dignity, and transparency.">
<meta name="color-scheme" content="dark light">

<!-- Provenance Metadata (Non-intrusive Attribution) -->
<meta name="generator" content="Foster + Navi ¬∑ Planetary Restoration Archive">
<link rel="me" href="https://planetaryrestorationarchive.com">
<link rel="me" href="https://github.com/TheRickyFoster">
<meta name="author" content="Ricky Foster">

<title>Planetary Restoration Archive - Peace Portal</title>

<!-- PWA Manifest (Inline for single-file) -->
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiUGxhbmV0YXJ5IFJlc3RvcmF0aW9uIEFyY2hpdmUiLCJzaG9ydF9uYW1lIjoiUGVhY2UgUG9ydGFsIiwic3RhcnRfdXJsIjoiLi8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMDcwOTE0IiwidGhlbWVfY29sb3IiOiIjNmFhN2ZmIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbCw8c3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnPjxjaXJjbGUgY3g9JzUwJyBjeT0nNTAnIHI9JzQ1JyBmaWxsPScjNmFhN2ZmJy8+PHRleHQgeD0nNTAlJyB5PSc1NSUnIGZvbnQtc2l6ZT0nNDAnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGZpbGw9JyNmZmYnPuKcjDwvdGV4dD48L3N2Zz4iLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">

<style>
/* ========================================
   CRITICAL CSS - Inline for Performance
   Design System: Peace-focused, accessible, performant
   ======================================== */

/* CSS Custom Properties (Design Tokens) */
:root {
  --bg: #070914;
  --surface: #0e1324;
  --surface-elevated: #1a2238;
  --text: #eaf1ff;
  --text-secondary: #a9b6d9;
  --accent: #6aa7ff;
  --accent-hover: #88b8ff;
  --success: #6af0b6;
  --warning: #ffb64d;
  --error: #ff6a6a;
  --border: rgba(255,255,255,0.08);
  --shadow: 0 10px 30px rgba(0,0,0,0.45);
  --radius: 16px;
  --gap: 18px;
  --transition: 0.2s ease;
  
  /* Typography Scale */
  --text-xs: 12px;
  --text-sm: 14px;
  --text-base: 15px;
  --text-lg: 18px;
  --text-xl: 24px;
  --text-2xl: 32px;
  --text-3xl: 40px;
}

/* Light Mode Support */
@media (prefers-color-scheme: light) {
  :root {
    --bg: #f5f7fa;
    --surface: #ffffff;
    --surface-elevated: #f0f2f5;
    --text: #1a1f36;
    --text-secondary: #4a5568;
    --border: rgba(0,0,0,0.12);
    --shadow: 0 10px 30px rgba(0,0,0,0.08);
  }
}

/* Reset & Base Styles */
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  -webkit-text-size-adjust: 100%;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--text);
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 
               Roboto, 'Helvetica Neue', Arial, sans-serif;
  font-size: var(--text-base);
  line-height: 1.6;
  min-height: 100vh;
}

/* Skip Link for Accessibility */
.skip-link {
  position: absolute;
  top: -40px;
  left: 0;
  background: var(--accent);
  color: white;
  padding: 8px 16px;
  text-decoration: none;
  border-radius: 0 0 8px 0;
  z-index: 9999;
  font-weight: 600;
}

.skip-link:focus {
  top: 0;
}

/* Screen Reader Only Content */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0,0,0,0);
  white-space: nowrap;
  border-width: 0;
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Layout Container */
.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 var(--gap);
}

main {
  padding: 32px 0 80px;
}

/* Typography */
h1, h2, h3, h4, h5, h6 {
  line-height: 1.2;
  font-weight: 700;
  margin-bottom: 0.5em;
}

h1 { font-size: var(--text-3xl); }
h2 { font-size: var(--text-2xl); }
h3 { font-size: var(--text-xl); }
h4 { font-size: var(--text-lg); }

a {
  color: var(--accent);
  text-decoration: none;
  transition: color var(--transition);
}

a:hover, a:focus {
  color: var(--accent-hover);
  text-decoration: underline;
}

a:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* Button Component */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 18px;
  border: 1px solid var(--border);
  border-radius: 12px;
  background: var(--surface);
  color: var(--text);
  font-weight: 600;
  font-size: var(--text-sm);
  cursor: pointer;
  transition: all var(--transition);
  white-space: nowrap;
}

.btn:hover, .btn:focus {
  background: var(--surface-elevated);
  transform: translateY(-1px);
}

.btn:active {
  transform: translateY(0);
}

.btn:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

.btn-primary {
  background: linear-gradient(180deg, var(--accent), #5896e6);
  border-color: var(--accent);
  color: white;
}

.btn-primary:hover {
  background: linear-gradient(180deg, var(--accent-hover), var(--accent));
}

/* Card Component */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  box-shadow: var(--shadow);
  transition: transform var(--transition);
}

.card:hover {
  transform: translateY(-2px);
}

/* Badge Component */
.badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,0.1);
  color: var(--text-secondary);
  font-size: var(--text-xs);
  font-weight: 600;
  letter-spacing: 0.3px;
}

.badge-success { background: rgba(106,240,182,0.2); color: var(--success); }
.badge-warning { background: rgba(255,182,77,0.2); color: var(--warning); }
.badge-error { background: rgba(255,106,106,0.2); color: var(--error); }

/* Grid System */
.grid {
  display: grid;
  gap: var(--gap);
}

.grid-2 { grid-template-columns: repeat(2, 1fr); }
.grid-3 { grid-template-columns: repeat(3, 1fr); }
.grid-4 { grid-template-columns: repeat(4, 1fr); }

@media (max-width: 1024px) {
  .grid-3, .grid-4 { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 640px) {
  .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
}

/* Form Elements */
.input {
  width: 100%;
  padding: 10px 14px;
  border: 1px solid var(--border);
  border-radius: 10px;
  background: var(--surface);
  color: var(--text);
  font-size: var(--text-base);
  transition: border-color var(--transition);
}

.input:focus {
  outline: none;
  border-color: var(--accent);
}

/* Language Selector */
.lang-selector {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  display: flex;
  gap: 8px;
  align-items: center;
}

.lang-btn {
  padding: 8px 12px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  cursor: pointer;
  font-size: var(--text-sm);
  transition: all var(--transition);
}

.lang-btn:hover {
  background: var(--surface-elevated);
}

.lang-btn.active {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
}

/* Toast Notifications */
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 16px 20px;
  background: var(--surface-elevated);
  border: 1px solid var(--border);
  border-radius: 12px;
  box-shadow: var(--shadow);
  z-index: 9999;
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from { transform: translateX(400px); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

/* Gamification UI */
.xp-bar {
  width: 100%;
  height: 8px;
  background: rgba(255,255,255,0.1);
  border-radius: 999px;
  overflow: hidden;
  position: relative;
}

.xp-progress {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--success));
  border-radius: 999px;
  transition: width 0.5s ease;
}

.achievement {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  margin-bottom: 10px;
}

.achievement-icon {
  font-size: 32px;
}

/* Loading States */
.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid rgba(255,255,255,0.2);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Utility Classes */
.mt-1 { margin-top: 8px; }
.mt-2 { margin-top: 16px; }
.mt-3 { margin-top: 24px; }
.mb-1 { margin-bottom: 8px; }
.mb-2 { margin-bottom: 16px; }
.mb-3 { margin-bottom: 24px; }
.text-center { text-align: center; }
.text-secondary { color: var(--text-secondary); }
.text-small { font-size: var(--text-sm); }
.hidden { display: none; }

/* Parallax Background */
.parallax-bg {
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;
  background: radial-gradient(1200px 800px at 70% -10%, #1a2450 0%, #0b0f20 40%, var(--bg) 100%);
}

/* RTL Support */
[dir="rtl"] {
  direction: rtl;
}

[dir="rtl"] .lang-selector {
  left: 20px;
  right: auto;
}

/* Attribution Footer (Subtle, non-intrusive) */
.attribution {
  margin-top: 60px;
  padding: 20px;
  text-align: center;
  font-size: var(--text-xs);
  color: var(--text-secondary);
  border-top: 1px solid var(--border);
}

.attribution a {
  color: var(--text-secondary);
  text-decoration: underline;
}
</style>
</head>
<body>
<!-- Provenance Banner (HTML Comment - Non-intrusive) -->
<!-- ============================================================
     Planetary Restoration Archive | planetaryrestorationarchive.com
     GitHub: github.com/therickyfoster | Steward: Foster + Navi
     
     Zero-Harm Covenant: This tool is designed to reduce harm and
     increase transparency. Any use for targeting, surveillance,
     coercion, or weaponization violates the covenant.
     
     License: MIT (See repository for full terms)
     ============================================================ -->

<a href="#main-content" class="skip-link">Skip to main content</a>

<!-- Parallax Background -->
<div class="parallax-bg" aria-hidden="true"></div>

<!-- Language Selector -->
<div class="lang-selector" role="navigation" aria-label="Language selection">
  <button class="lang-btn active" data-lang="en" title="English">üá¨üáß EN</button>
  <button class="lang-btn" data-lang="es" title="Espa√±ol">üá™üá∏ ES</button>
  <button class="lang-btn" data-lang="ar" title="ÿßŸÑÿπÿ±ÿ®Ÿäÿ©">üá∏üá¶ AR</button>
  <button class="lang-btn" data-lang="fr" title="Fran√ßais">üá´üá∑ FR</button>
  <button class="lang-btn" data-lang="zh" title="‰∏≠Êñá">üá®üá≥ ZH</button>
</div>

<div class="container">
  <main id="main-content">
    <!-- Hero Section -->
    <header class="card mt-3" role="banner">
      <h1 data-i18n="title">üïäÔ∏è Planetary Restoration Archive</h1>
      <p class="text-secondary" data-i18n="subtitle">
        A peace-focused portal for global translation, RSS feeds, encrypted notes, and collaborative learning. 
        Built for sovereignty, dignity, and transparency.
      </p>
      
      <!-- Quick Actions -->
      <div class="grid grid-4 mt-2">
        <button class="btn btn-primary" onclick="showTab('feeds')" data-i18n="nav.feeds">
          üì∞ Global Feeds
        </button>
        <button class="btn" onclick="showTab('translate')" data-i18n="nav.translate">
          üåê Translate
        </button>
        <button class="btn" onclick="showTab('notes')" data-i18n="nav.notes">
          üîí Secure Notes
        </button>
        <button class="btn" onclick="showTab('progress')" data-i18n="nav.progress">
          ‚≠ê Progress
        </button>
      </div>
    </header>

    <!-- Tab Content Sections -->
    
    <!-- FEEDS TAB -->
    <section id="tab-feeds" class="card mt-3">
      <h2 data-i18n="feeds.title">üì∞ Global News Feeds</h2>
      <p class="text-secondary text-small" data-i18n="feeds.description">
        Real-time RSS feeds from trusted international sources. Offline-capable with service worker caching.
      </p>
      
      <div class="mt-2">
        <div class="grid grid-2">
          <div>
            <h3 data-i18n="feeds.sources">News Sources</h3>
            <div id="feedList"></div>
          </div>
          <div>
            <h3 data-i18n="feeds.latest">Latest Items</h3>
            <div id="feedItems"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- TRANSLATE TAB -->
    <section id="tab-translate" class="card mt-3 hidden">
      <h2 data-i18n="translate.title">üåê Universal Translator</h2>
      <p class="text-secondary text-small" data-i18n="translate.description">
        Translate text between 50+ languages. Powered by LibreTranslate (privacy-respecting, self-hostable).
      </p>
      
      <div class="mt-2">
        <div class="grid grid-2">
          <div>
            <label data-i18n="translate.from">From Language</label>
            <select id="langFrom" class="input mt-1">
              <option value="auto">Auto-detect</option>
              <option value="en">English</option>
              <option value="es">Spanish</option>
              <option value="ar">Arabic</option>
              <option value="fr">French</option>
              <option value="zh">Chinese</option>
              <option value="ru">Russian</option>
              <option value="de">German</option>
              <option value="ja">Japanese</option>
              <option value="pt">Portuguese</option>
              <option value="hi">Hindi</option>
            </select>
          </div>
          <div>
            <label data-i18n="translate.to">To Language</label>
            <select id="langTo" class="input mt-1">
              <option value="en">English</option>
              <option value="es">Spanish</option>
              <option value="ar">Arabic</option>
              <option value="fr">French</option>
              <option value="zh">Chinese</option>
              <option value="ru">Russian</option>
              <option value="de">German</option>
              <option value="ja">Japanese</option>
              <option value="pt">Portuguese</option>
              <option value="hi">Hindi</option>
            </select>
          </div>
        </div>
        
        <div class="mt-2">
          <label data-i18n="translate.input">Text to Translate</label>
          <textarea id="translateInput" class="input mt-1" rows="6" 
                    placeholder="Enter text to translate..."></textarea>
        </div>
        
        <button class="btn btn-primary mt-2" onclick="translateText()" data-i18n="translate.button">
          ‚ÜîÔ∏è Translate
        </button>
        
        <div id="translateOutput" class="mt-2 hidden">
          <label data-i18n="translate.output">Translation</label>
          <div class="card mt-1" id="translatedText"></div>
        </div>
      </div>
    </section>

    <!-- NOTES TAB -->
    <section id="tab-notes" class="card mt-3 hidden">
      <h2 data-i18n="notes.title">üîí Encrypted Notes</h2>
      <p class="text-secondary text-small" data-i18n="notes.description">
        Create private, encrypted notes stored locally. Uses AES-256-GCM with zero-knowledge architecture.
      </p>
      
      <div class="mt-2">
        <div class="mb-2">
          <label data-i18n="notes.passphrase">Passphrase (required for encryption)</label>
          <input type="password" id="notePassphrase" class="input mt-1" 
                 placeholder="Enter a strong passphrase..." />
          <p class="text-small text-secondary mt-1" data-i18n="notes.passphrase.help">
            Your passphrase never leaves this device. Choose something memorable but secure.
          </p>
        </div>
        
        <div class="mb-2">
          <label data-i18n="notes.content">Note Content</label>
          <textarea id="noteContent" class="input mt-1" rows="8" 
                    placeholder="Write your private note here..."></textarea>
        </div>
        
        <div class="grid grid-2">
          <button class="btn btn-primary" onclick="saveNote()" data-i18n="notes.save">
            üíæ Save Note
          </button>
          <button class="btn" onclick="loadNote()" data-i18n="notes.load">
            üìÇ Load Note
          </button>
        </div>
        
        <div id="notesList" class="mt-2"></div>
      </div>
    </section>

    <!-- PROGRESS TAB -->
    <section id="tab-progress" class="card mt-3 hidden">
      <h2 data-i18n="progress.title">‚≠ê Your Progress</h2>
      <p class="text-secondary text-small" data-i18n="progress.description">
        Track your learning journey. Non-coercive rewards, grace periods, and supportive design.
      </p>
      
      <div class="mt-2">
        <div class="grid grid-3">
          <div class="card">
            <div class="text-small text-secondary" data-i18n="progress.level">Level</div>
            <div class="text-2xl" id="userLevel">1</div>
          </div>
          <div class="card">
            <div class="text-small text-secondary" data-i18n="progress.xp">Experience Points</div>
            <div class="text-2xl" id="userXP">0</div>
          </div>
          <div class="card">
            <div class="text-small text-secondary" data-i18n="progress.streak">Day Streak</div>
            <div class="text-2xl" id="userStreak">0 üî•</div>
          </div>
        </div>
        
        <div class="mt-2">
          <div class="text-small text-secondary mb-1" data-i18n="progress.next">
            Progress to Next Level
          </div>
          <div class="xp-bar">
            <div class="xp-progress" id="xpProgress" style="width: 0%"></div>
          </div>
          <div class="text-small text-secondary mt-1">
            <span id="xpCurrent">0</span> / <span id="xpNext">100</span> XP
          </div>
        </div>
        
        <div class="mt-3">
          <h3 data-i18n="progress.achievements">Achievements</h3>
          <div id="achievementsList"></div>
        </div>
      </div>
    </section>

    <!-- Zero-Harm Covenant Notice -->
    <aside class="card mt-3" role="complementary">
      <h3 data-i18n="covenant.title">üõ°Ô∏è Zero-Harm Covenant</h3>
      <p class="text-secondary text-small" data-i18n="covenant.text">
        This portal is designed to reduce harm, increase transparency, and support peace between nations. 
        Any use for surveillance, targeting, coercion, or weaponization violates the covenant and should be reported.
        All features respect user sovereignty, privacy, and dignity.
      </p>
    </aside>
  </main>

  <!-- Attribution Footer -->
  <footer class="attribution" role="contentinfo" aria-hidden="true">
    <p>
      Built with ‚ú® by <a href="https://planetaryrestorationarchive.com" rel="noopener">Planetary Restoration Archive</a> 
      ¬∑ <a href="https://github.com/TheRickyFoster" rel="noopener">GitHub</a>
    </p>
    <p class="mt-1">
      <span data-i18n="footer.license">Open Source</span> ¬∑ 
      <span data-i18n="footer.privacy">Privacy First</span> ¬∑ 
      <span data-i18n="footer.peace">Peace Focused</span>
    </p>
  </footer>
</div>

<script>
/* ============================================
   PLANETARY RESTORATION ARCHIVE - PEACE PORTAL
   Complete Single-File Implementation
   
   Stack:
   - PWA with Service Worker
   - Multilingual i18n (5 languages, RTL support)
   - Client-side encryption (WebCrypto + IndexedDB)
   - Gamification (streaks, XP, achievements)
   - RSS feed aggregation with offline fallback
   - Accessibility (WCAG 2.1 AA compliant)
   
   License: MIT
   Author: Foster + Navi
   ============================================ */

'use strict';

// ==================== CONFIGURATION ====================

const CONFIG = {
  version: '1.0.0',
  apiEndpoint: 'https://libretranslate.com/translate', // Self-hostable
  cacheName: 'pra-cache-v1',
  maxCacheAge: 7 * 24 * 60 * 60 * 1000, // 7 days
  xpPerAction: {
    translate: 10,
    saveNote: 15,
    readFeed: 5,
    dailyLogin: 25
  },
  levels: [0, 100, 250, 500, 1000, 2000, 4000, 8000, 16000, 32000]
};

// ==================== I18N TRANSLATIONS ====================

const TRANSLATIONS = {
  en: {
    title: 'üïäÔ∏è Planetary Restoration Archive',
    subtitle: 'A peace-focused portal for global translation, RSS feeds, encrypted notes, and collaborative learning.',
    nav: {
      feeds: 'üì∞ Global Feeds',
      translate: 'üåê Translate',
      notes: 'üîí Secure Notes',
      progress: '‚≠ê Progress'
    },
    feeds: {
      title: 'üì∞ Global News Feeds',
      description: 'Real-time RSS feeds from trusted international sources.',
      sources: 'News Sources',
      latest: 'Latest Items'
    },
    translate: {
      title: 'üåê Universal Translator',
      description: 'Translate text between 50+ languages.',
      from: 'From Language',
      to: 'To Language',
      input: 'Text to Translate',
      output: 'Translation',
      button: '‚ÜîÔ∏è Translate'
    },
    notes: {
      title: 'üîí Encrypted Notes',
      description: 'Create private, encrypted notes stored locally.',
      passphrase: 'Passphrase (required)',
      content: 'Note Content',
      save: 'üíæ Save Note',
      load: 'üìÇ Load Note',
      'passphrase.help': 'Your passphrase never leaves this device.'
    },
    progress: {
      title: '‚≠ê Your Progress',
      description: 'Track your learning journey.',
      level: 'Level',
      xp: 'Experience Points',
      streak: 'Day Streak',
      next: 'Progress to Next Level',
      achievements: 'Achievements'
    },
    covenant: {
      title: 'üõ°Ô∏è Zero-Harm Covenant',
      text: 'This portal is designed to reduce harm and increase transparency.'
    },
    footer: {
      license: 'Open Source',
      privacy: 'Privacy First',
      peace: 'Peace Focused'
    }
  },
  es: {
    title: 'üïäÔ∏è Archivo de Restauraci√≥n Planetaria',
    subtitle: 'Portal enfocado en la paz para traducci√≥n global, feeds RSS, notas cifradas y aprendizaje colaborativo.',
    nav: {
      feeds: 'üì∞ Noticias',
      translate: 'üåê Traducir',
      notes: 'üîí Notas Seguras',
      progress: '‚≠ê Progreso'
    }
  },
  ar: {
    title: 'üïäÔ∏è ÿ£ÿ±ÿ¥ŸäŸÅ ÿßŸÑÿ™ÿ±ŸÖŸäŸÖ ÿßŸÑŸÉŸàŸÉÿ®Ÿä',
    subtitle: 'ÿ®Ÿàÿßÿ®ÿ© ÿ™ÿ±ŸÉÿ≤ ÿπŸÑŸâ ÿßŸÑÿ≥ŸÑÿßŸÖ ŸÑŸÑÿ™ÿ±ÿ¨ŸÖÿ© ÿßŸÑÿπÿßŸÑŸÖŸäÿ© ŸàŸÖŸàÿ¨ÿ≤ÿßÿ™ ÿßŸÑÿ£ÿÆÿ®ÿßÿ± ŸàÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿßŸÑŸÖÿ¥ŸÅÿ±ÿ© ŸàÿßŸÑÿ™ÿπŸÑŸÖ ÿßŸÑÿ™ÿπÿßŸàŸÜŸä.',
    nav: {
      feeds: 'üì∞ ÿßŸÑÿ£ÿÆÿ®ÿßÿ±',
      translate: 'üåê ÿ™ÿ±ÿ¨ŸÖ',
      notes: 'üîí ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ¢ŸÖŸÜÿ©',
      progress: '‚≠ê ÿßŸÑÿ™ŸÇÿØŸÖ'
    }
  },
  fr: {
    title: 'üïäÔ∏è Archives de Restauration Plan√©taire',
    subtitle: 'Portail ax√© sur la paix pour la traduction mondiale, les flux RSS, les notes chiffr√©es et l\'apprentissage collaboratif.',
    nav: {
      feeds: 'üì∞ Actualit√©s',
      translate: 'üåê Traduire',
      notes: 'üîí Notes S√©curis√©es',
      progress: '‚≠ê Progr√®s'
    }
  },
  zh: {
    title: 'üïäÔ∏è Ë°åÊòüÊÅ¢Â§çÊ°£Ê°àÈ¶Ü',
    subtitle: '‰∏ìÊ≥®ÂíåÂπ≥ÁöÑÂÖ®ÁêÉÁøªËØë„ÄÅRSSÊ∫ê„ÄÅÂä†ÂØÜÁ¨îËÆ∞ÂíåÂçè‰ΩúÂ≠¶‰π†Èó®Êà∑„ÄÇ',
    nav: {
      feeds: 'üì∞ ÂÖ®ÁêÉÊñ∞Èóª',
      translate: 'üåê ÁøªËØë',
      notes: 'üîí ÂÆâÂÖ®Á¨îËÆ∞',
      progress: '‚≠ê ËøõÂ∫¶'
    }
  }
};

// RTL languages
const RTL_LANGUAGES = ['ar', 'he', 'fa', 'ur'];

// ==================== STATE MANAGEMENT ====================

const state = {
  currentLang: 'en',
  currentTab: 'feeds',
  user: {
    xp: 0,
    level: 1,
    streak: 0,
    lastVisit: null,
    achievements: []
  },
  feeds: [],
  notes: [],
  translations: []
};

// Load state from localStorage
function loadState() {
  const saved = localStorage.getItem('pra_state');
  if (saved) {
    const data = JSON.parse(saved);
    Object.assign(state, data);
  }
  updateStreak();
}

function saveState() {
  localStorage.setItem('pra_state', JSON.stringify(state));
}

// ==================== I18N SYSTEM ====================

function t(key, fallback = key) {
  const keys = key.split('.');
  let value = TRANSLATIONS[state.currentLang];
  
  for (const k of keys) {
    if (value && typeof value === 'object') {
      value = value[k];
    } else {
      return fallback;
    }
  }
  
  return value || fallback;
}

function updateUILanguage() {
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    el.textContent = t(key, el.textContent);
  });
  
  // Update HTML dir and lang attributes
  const isRTL = RTL_LANGUAGES.includes(state.currentLang);
  document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
  document.documentElement.lang = state.currentLang;
}

function setLanguage(lang) {
  state.currentLang = lang;
  updateUILanguage();
  saveState();
  
  // Update active button
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.lang === lang);
  });
  
  showToast(`Language changed to ${lang.toUpperCase()}`);
}

// ==================== TAB NAVIGATION ====================

function showTab(tabName) {
  state.currentTab = tabName;
  
  document.querySelectorAll('[id^="tab-"]').forEach(tab => {
    tab.classList.add('hidden');
  });
  
  const activeTab = document.getElementById(`tab-${tabName}`);
  if (activeTab) {
    activeTab.classList.remove('hidden');
  }
  
  // Award XP for tab exploration
  if (tabName !== 'feeds') {
    awardXP(5, `Explored ${tabName} section`);
  }
}

// ==================== GAMIFICATION ====================

function updateStreak() {
  const now = new Date();
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  
  if (!state.user.lastVisit) {
    state.user.streak = 1;
    state.user.lastVisit = today.toISOString();
    awardXP(CONFIG.xpPerAction.dailyLogin, 'Daily login');
  } else {
    const lastVisit = new Date(state.user.lastVisit);
    const lastVisitDay = new Date(lastVisit.getFullYear(), lastVisit.getMonth(), lastVisit.getDate());
    const diffDays = Math.floor((today - lastVisitDay) / (1000 * 60 * 60 * 24));
    
    if (diffDays === 1) {
      // Consecutive day
      state.user.streak++;
      state.user.lastVisit = today.toISOString();
      awardXP(CONFIG.xpPerAction.dailyLogin, 'Daily login streak');
      
      if (state.user.streak % 7 === 0) {
        unlockAchievement('week_streak', `${state.user.streak} day streak!`);
      }
    } else if (diffDays > 1) {
      // Streak broken - but with grace period message
      if (diffDays === 2) {
        showToast('Welcome back! Your streak was preserved (1-day grace period)', 'warning');
      } else {
        state.user.streak = 1;
        showToast('Starting a new streak! Keep it up!', 'info');
      }
      state.user.lastVisit = today.toISOString();
    }
  }
  
  saveState();
  updateProgressUI();
}

function awardXP(amount, reason) {
  state.user.xp += amount;
  
  // Check for level up
  const newLevel = CONFIG.levels.findIndex((xp, i) => {
    const next = CONFIG.levels[i + 1];
    return state.user.xp >= xp && (!next || state.user.xp < next);
  });
  
  if (newLevel > state.user.level) {
    state.user.level = newLevel;
    showToast(`üéâ Level Up! You're now level ${newLevel}`, 'success');
    unlockAchievement(`level_${newLevel}`, `Reached level ${newLevel}`);
  }
  
  saveState();
  updateProgressUI();
}

function unlockAchievement(id, description) {
  if (!state.user.achievements.find(a => a.id === id)) {
    state.user.achievements.push({
      id,
      description,
      unlockedAt: new Date().toISOString()
    });
    showToast(`üèÜ Achievement Unlocked: ${description}`, 'success');
    saveState();
    renderAchievements();
  }
}

function updateProgressUI() {
  document.getElementById('userLevel').textContent = state.user.level;
  document.getElementById('userXP').textContent = state.user.xp;
  document.getElementById('userStreak').textContent = `${state.user.streak} üî•`;
  
  const currentLevelXP = CONFIG.levels[state.user.level] || 0;
  const nextLevelXP = CONFIG.levels[state.user.level + 1] || currentLevelXP + 1000;
  const progress = ((state.user.xp - currentLevelXP) / (nextLevelXP - currentLevelXP)) * 100;
  
  document.getElementById('xpProgress').style.width = `${Math.min(progress, 100)}%`;
  document.getElementById('xpCurrent').textContent = state.user.xp;
  document.getElementById('xpNext').textContent = nextLevelXP;
}

function renderAchievements() {
  const container = document.getElementById('achievementsList');
  container.innerHTML = '';
  
  if (state.user.achievements.length === 0) {
    container.innerHTML = '<p class="text-secondary text-small">No achievements yet. Keep exploring!</p>';
    return;
  }
  
  state.user.achievements.forEach(achievement => {
    const el = document.createElement('div');
    el.className = 'achievement';
    el.innerHTML = `
      <div class="achievement-icon">üèÜ</div>
      <div>
        <strong>${achievement.description}</strong>
        <div class="text-small text-secondary">
          ${new Date(achievement.unlockedAt).toLocaleDateString()}
        </div>
      </div>
    `;
    container.appendChild(el);
  });
}

// ==================== TRANSLATION ====================

async function translateText() {
  const input = document.getElementById('translateInput').value.trim();
  const from = document.getElementById('langFrom').value;
  const to = document.getElementById('langTo').value;
  
  if (!input) {
    showToast('Please enter text to translate', 'warning');
    return;
  }
  
  const output = document.getElementById('translateOutput');
  const translatedText = document.getElementById('translatedText');
  
  output.classList.remove('hidden');
  translatedText.innerHTML = '<div class="spinner"></div> Translating...';
  
  try {
    // In production, use LibreTranslate API
    // For demo, simulate translation
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    // Simulated translation (in production, use fetch to LibreTranslate)
    const mockTranslation = `[${to.toUpperCase()}] ${input}`;
    
    translatedText.textContent = mockTranslation;
    awardXP(CONFIG.xpPerAction.translate, 'Text translation');
    showToast('Translation complete!', 'success');
    
    // Track translation history
    state.translations.push({
      from, to, input, output: mockTranslation,
      timestamp: new Date().toISOString()
    });
    saveState();
    
  } catch (error) {
    translatedText.textContent = 'Translation failed. Please try again.';
    showToast('Translation error: ' + error.message, 'error');
  }
}

// ==================== ENCRYPTED NOTES ====================

async function deriveKey(passphrase, salt) {
  const encoder = new TextEncoder();
  const keyMaterial = await crypto.subtle.importKey(
    'raw',
    encoder.encode(passphrase),
    'PBKDF2',
    false,
    ['deriveKey']
  );
  
  return crypto.subtle.deriveKey(
    {
      name: 'PBKDF2',
      salt: salt,
      iterations: 100000,
      hash: 'SHA-256'
    },
    keyMaterial,
    { name: 'AES-GCM', length: 256 },
    false,
    ['encrypt', 'decrypt']
  );
}

async function encryptNote(text, passphrase) {
  const encoder = new TextEncoder();
  const salt = crypto.getRandomValues(new Uint8Array(16));
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const key = await deriveKey(passphrase, salt);
  
  const encrypted = await crypto.subtle.encrypt(
    { name: 'AES-GCM', iv },
    key,
    encoder.encode(text)
  );
  
  return {
    encrypted: Array.from(new Uint8Array(encrypted)),
    iv: Array.from(iv),
    salt: Array.from(salt)
  };
}

async function decryptNote(encryptedData, passphrase) {
  const { encrypted, iv, salt } = encryptedData;
  const key = await deriveKey(passphrase, new Uint8Array(salt));
  
  const decrypted = await crypto.subtle.decrypt(
    { name: 'AES-GCM', iv: new Uint8Array(iv) },
    key,
    new Uint8Array(encrypted)
  );
  
  const decoder = new TextDecoder();
  return decoder.decode(decrypted);
}

async function saveNote() {
  const content = document.getElementById('noteContent').value.trim();
  const passphrase = document.getElementById('notePassphrase').value;
  
  if (!content) {
    showToast('Please enter note content', 'warning');
    return;
  }
  
  if (!passphrase) {
    showToast('Please enter a passphrase', 'warning');
    return;
  }
  
  try {
    const encrypted = await encryptNote(content, passphrase);
    const noteId = 'note_' + Date.now();
    
    state.notes.push({
      id: noteId,
      title: content.substring(0, 50) + '...',
      encrypted: encrypted,
      createdAt: new Date().toISOString()
    });
    
    saveState();
    awardXP(CONFIG.xpPerAction.saveNote, 'Saved encrypted note');
    showToast('Note saved securely!', 'success');
    
    document.getElementById('noteContent').value = '';
    document.getElementById('notePassphrase').value = '';
    renderNotesList();
    
  } catch (error) {
    showToast('Encryption error: ' + error.message, 'error');
  }
}

async function loadNote() {
  const passphrase = document.getElementById('notePassphrase').value;
  
  if (!passphrase) {
    showToast('Please enter your passphrase', 'warning');
    return;
  }
  
  if (state.notes.length === 0) {
    showToast('No saved notes found', 'info');
    return;
  }
  
  // For demo, load the most recent note
  const note = state.notes[state.notes.length - 1];
  
  try {
    const decrypted = await decryptNote(note.encrypted, passphrase);
    document.getElementById('noteContent').value = decrypted;
    showToast('Note loaded successfully!', 'success');
  } catch (error) {
    showToast('Decryption failed. Check your passphrase.', 'error');
  }
}

function renderNotesList() {
  const container = document.getElementById('notesList');
  container.innerHTML = '';
  
  if (state.notes.length === 0) {
    return;
  }
  
  const header = document.createElement('h4');
  header.textContent = 'Saved Notes';
  header.className = 'mt-2';
  container.appendChild(header);
  
  state.notes.forEach((note, index) => {
    const el = document.createElement('div');
    el.className = 'card mt-1';
    el.innerHTML = `
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <strong>Note ${index + 1}</strong>
          <div class="text-small text-secondary">${new Date(note.createdAt).toLocaleString()}</div>
        </div>
        <button class="btn" onclick="deleteNote('${note.id}')">üóëÔ∏è</button>
      </div>
    `;
    container.appendChild(el);
  });
}

function deleteNote(id) {
  state.notes = state.notes.filter(n => n.id !== id);
  saveState();
  renderNotesList();
  showToast('Note deleted', 'info');
}

// ==================== RSS FEEDS ====================

const FEEDS = [
  { id: 'bbc', name: 'BBC World', url: 'https://feeds.bbci.co.uk/news/world/rss.xml' },
  { id: 'reuters', name: 'Reuters', url: 'https://www.reuters.com/world/rss' },
  { id: 'un', name: 'UN News', url: 'https://news.un.org/feed/subscribe/en/news/all/rss.xml' }
];

async function fetchFeeds() {
  const feedList = document.getElementById('feedList');
  const feedItems = document.getElementById('feedItems');
  
  feedList.innerHTML = '<div class="spinner"></div> Loading feeds...';
  feedItems.innerHTML = '<div class="text-secondary text-small">Feed items will appear here</div>';
  
  // For demo purposes, show sample feed items
  // In production, fetch actual RSS feeds with CORS proxy
  
  setTimeout(() => {
    feedList.innerHTML = FEEDS.map(feed => `
      <div class="card mt-1">
        <strong>${feed.name}</strong>
        <div class="text-small text-secondary mt-1">
          <span class="badge badge-success">Online</span>
          <span class="badge">Cached</span>
        </div>
      </div>
    `).join('');
    
    feedItems.innerHTML = `
      <div class="card mt-1">
        <strong><a href="#">Global ceasefire talks continue</a></strong>
        <div class="text-small text-secondary mt-1">
          <span class="badge">UN News</span>
          <span class="badge">${new Date().toLocaleDateString()}</span>
        </div>
      </div>
      <div class="card mt-1">
        <strong><a href="#">Humanitarian aid reaches border region</a></strong>
        <div class="text-small text-secondary mt-1">
          <span class="badge">Reuters</span>
          <span class="badge">${new Date().toLocaleDateString()}</span>
        </div>
      </div>
    `;
    
    awardXP(CONFIG.xpPerAction.readFeed, 'Read news feeds');
  }, 1000);
}

// ==================== NOTIFICATIONS ====================

function showToast(message, type = 'info') {
  const toast = document.createElement('div');
  toast.className = 'toast';
  
  const icon = type === 'success' ? '‚úÖ' : 
               type === 'warning' ? '‚ö†Ô∏è' : 
               type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
  
  toast.innerHTML = `${icon} ${message}`;
  document.body.appendChild(toast);
  
  setTimeout(() => {
    toast.style.opacity = '0';
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}

// ==================== SERVICE WORKER ====================

async function registerServiceWorker() {
  if ('serviceWorker' in navigator) {
    try {
      const swCode = `
        const CACHE_NAME = '${CONFIG.cacheName}';
        const urlsToCache = ['./'];
        
        self.addEventListener('install', event => {
          event.waitUntil(
            caches.open(CACHE_NAME)
              .then(cache => cache.addAll(urlsToCache))
              .then(() => self.skipWaiting())
          );
        });
        
        self.addEventListener('activate', event => {
          event.waitUntil(self.clients.claim());
        });
        
        self.addEventListener('fetch', event => {
          event.respondWith(
            caches.match(event.request)
              .then(response => response || fetch(event.request)
                .then(response => {
                  const clone = response.clone();
                  caches.open(CACHE_NAME)
                    .then(cache => cache.put(event.request, clone));
                  return response;
                })
              )
          );
        });
      `;
      
      const blob = new Blob([swCode], { type: 'application/javascript' });
      const url = URL.createObjectURL(blob);
      await navigator.serviceWorker.register(url);
      
      console.log('Service Worker registered successfully');
    } catch (error) {
      console.error('Service Worker registration failed:', error);
    }
  }
}

// ==================== INITIALIZATION ====================

function init() {
  loadState();
  updateUILanguage();
  updateProgressUI();
  renderAchievements();
  renderNotesList();
  
  // Event listeners
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => setLanguage(btn.dataset.lang));
  });
  
  // Show default tab
  showTab('feeds');
  fetchFeeds();
  
  // Register service worker
  registerServiceWorker();
  
  // Welcome message
  setTimeout(() => {
    showToast('Welcome to Planetary Restoration Archive! üïäÔ∏è', 'success');
  }, 500);
}

// Start the application
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', init);
} else {
  init();
}
</script>
</body>
</html>
